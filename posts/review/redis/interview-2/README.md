---
sort: 2
title: Redis面试题-场景
description: Redis面经，资源从网络收集
date: 2024-04-30 17:19:04
tags: ['Redis']
---

# Redis面试题-场景

:::tip 声明
本文中部分内容摘自网络(下方表示出处)，如有违规可联系我进行删除 🙏🏻
> * [https://github.com/chaseSpace/interview/blob/main/db_redis.md](https://github.com/chaseSpace/interview/blob/main/db_redis.md)
:::

::: details 目录索引
[[toc]]
:::
## 1. 缓存

Redis实现缓存功能的基本原理是将常用的数据存储在内存中，以加快数据访问速度，并且可以通过设置过期时间来自动淘汰过期的缓存数据。适合缓存的数据是那些更新频率较低，访问频率较高的数据，例如商品信息，用户信息等。

## 2. 延迟队列

延迟队列是一种用于处理延迟消息的队列，它的主要特点是能够在指定的时间间隔后消费消息（执行任务）。基本上类似一个任务调度服务，只是处理的对象是消息而不是任务，常见使用场景有以下几种：

* 在购物平台下单，超时未成功付款，订单进行自动取消
* 打车时，规定时间内没有车主接单，订单进行自动取消

### 实现方案
1. 在redis中可以使用有序集合（ZSet）来实现延迟消息队列，ZSet有一个Score属性可以用来存储延迟执行的时间。
2. 使用`zadd score1 value1`命令就可以一直往内存中生产消息，再利用`zrangebyscore`查询复合条件的所有待处理的任务，通过循环执行队列任务即可。

### 存在问题
* 消息没有持久化，如果服务器宕机或重启，消息可能会丢失
* 没有ACK机制，如果消费失败，消息会丢失。有大佬实现了个支持ACK的 [🔗 用 Redis 做一个可靠的延迟队列](https://juejin.cn/post/7111939271757398023)

## 3. 消息队列

常见消息队列选型Kafka、RocketMQ等服务相对Redis比较重，对于一些简单的，没有大量消息堆积的非关键业务场景可以使用Redis来实现消息队列。

Redis中可以使用List、Stream、Pub/Sub 来实现简单的消息队列

### List实现MQ

Redis队列是简单的字符串列表，按照插入顺序排序，你可以添加一个元素到列表的头部（左边）或者尾部（右边）。通过使用以下命令，可以实现一个简单的消息队列功能：
* LPUSH、RPOP 左进右出
* RPUSH、LPOP 右进左出

使用RPOP、LPOP命令消费数据时有个问题就是需要消费者轮询Redis，所以可以使用BRPOP、BLPOP避免这个问题。

#### 实现ACK机制

Redis中可以使用双队列来实现ACK机制，步骤如下：
* 准备两个队列，其中存储数据的队列为`queue1`，另一个队列名为`queue1_bak`
* 消费者使用`RPOPLPUSH`或`BRPOPLPUSH`命令消费数据（数据在弹出的同时将备份到另一个 bak 队列）
* 消费者消费数据成功后，使用`LREM`命令消费 bak 队列的数据
* 启用定时任务，使用`LRANGE`命令读取队列数据，解析每条数据（需要包含产生时间戳），将超市消息（认为消费失败）重新入队`queue1`
	* 超时定义：因为使用redis的队列场景一般不存在大量消息堆积，所以可以简单定一个时间
	* 因为这里的超时定义不严谨，所以建议消息中包含唯一ID实现幂等消费，否则可能会重新消费